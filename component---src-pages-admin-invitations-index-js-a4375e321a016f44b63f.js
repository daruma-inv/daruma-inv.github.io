"use strict";(self.webpackChunkcorporate=self.webpackChunkcorporate||[]).push([[986],{5423:function(e,t,n){var a=n(4994);t.A=void 0;var r=a(n(2032)),l=n(4848);t.A=(0,r.default)((0,l.jsx)("path",{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4z"}),"Logout")},2030:function(e,t,n){n.d(t,{A:function(){return B}});var a=n(6540),r=n(4794);class l extends Error{}function o(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function(e){return decodeURIComponent(atob(e).replace(/(.)/g,((e,t)=>{let n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(n){return atob(t)}}function i(e,t){if("string"!=typeof e)throw new l("Invalid token specified: must be a string");t||(t={});const n=!0===t.header?0:1,a=e.split(".")[n];if("string"!=typeof a)throw new l(`Invalid token specified: missing part #${n+1}`);let r;try{r=o(a)}catch(i){throw new l(`Invalid token specified: invalid base64 for part #${n+1} (${i.message})`)}try{return JSON.parse(r)}catch(i){throw new l(`Invalid token specified: invalid json for part #${n+1} (${i.message})`)}}l.prototype.name="InvalidTokenError";var c=n(9502),s=n(8587),m=n(8168),u=n(4164),d=n(5659),p=n(1848),A=n(5669),E=n(5003),f=n(4848),g=(0,E.A)((0,f.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person"),v=n(8413),h=n(1609);function y(e){return(0,h.Ay)("MuiAvatar",e)}(0,v.A)("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);var w=n(6025);const S=["alt","children","className","component","slots","slotProps","imgProps","sizes","src","srcSet","variant"],b=(0,p.Ay)("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],n.colorDefault&&t.colorDefault]}})((({theme:e})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(e.vars||e).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:(0,m.A)({color:(e.vars||e).palette.background.default},e.vars?{backgroundColor:e.vars.palette.Avatar.defaultBg}:(0,m.A)({backgroundColor:e.palette.grey[400]},e.applyStyles("dark",{backgroundColor:e.palette.grey[600]})))}]}))),x=(0,p.Ay)("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(e,t)=>t.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),k=(0,p.Ay)(g,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(e,t)=>t.fallback})({width:"75%",height:"75%"});var P=a.forwardRef((function(e,t){const n=(0,A.b)({props:e,name:"MuiAvatar"}),{alt:r,children:l,className:o,component:i="div",slots:c={},slotProps:p={},imgProps:E,sizes:g,src:v,srcSet:h,variant:P="circular"}=n,C=(0,s.A)(n,S);let I=null;const D=function({crossOrigin:e,referrerPolicy:t,src:n,srcSet:r}){const[l,o]=a.useState(!1);return a.useEffect((()=>{if(!n&&!r)return;o(!1);let a=!0;const l=new Image;return l.onload=()=>{a&&o("loaded")},l.onerror=()=>{a&&o("error")},l.crossOrigin=e,l.referrerPolicy=t,l.src=n,r&&(l.srcset=r),()=>{a=!1}}),[e,t,n,r]),l}((0,m.A)({},E,{src:v,srcSet:h})),$=v||h,j=$&&"error"!==D,z=(0,m.A)({},n,{colorDefault:!j,component:i,variant:P}),R=(e=>{const{classes:t,variant:n,colorDefault:a}=e,r={root:["root",n,a&&"colorDefault"],img:["img"],fallback:["fallback"]};return(0,d.A)(r,y,t)})(z),[N,B]=(0,w.A)("img",{className:R.img,elementType:x,externalForwardedProps:{slots:c,slotProps:{img:(0,m.A)({},E,p.img)}},additionalProps:{alt:r,src:v,srcSet:h,sizes:g},ownerState:z});return I=j?(0,f.jsx)(N,(0,m.A)({},B)):l||0===l?l:$&&r?r[0]:(0,f.jsx)(k,{ownerState:z,className:R.fallback}),(0,f.jsx)(b,(0,m.A)({as:i,ownerState:z,className:(0,u.A)(R.root,o),ref:t},C,{children:I}))})),C=n(9828),I=n(9067),D=n(6990),$=n(7834),j=n(8532),z=n(4073),R=n(5423);const N="com.daruma-inv.admin";var B=e=>{const{children:t}=e,{0:n,1:l}=(0,a.useState)(!1),{0:o,1:s}=(0,a.useState)(!1),{0:m,1:u}=(0,a.useState)(""),{0:d,1:p}=(0,a.useState)(""),{0:A,1:E}=(0,a.useState)(""),{0:f,1:g}=(0,a.useState)(""),{0:v,1:h}=(0,a.useState)(""),y=()=>{u(""),p(""),E(""),g(""),h(""),e.setUsername&&e.setUsername(""),e.setEmail&&e.setEmail("")};(0,a.useEffect)((()=>{const t=()=>{window.google.accounts.id.initialize({client_id:"137389090265-9p2asf68ustrc46nemdmmi8d4l5gnapm.apps.googleusercontent.com",callback:e=>{let{credential:t}=e;const{email:n}=i(t);if(!/@daruma-inv.com$/.test(n)&&"koujirou0111@gmail.com"!==n&&"oxwm.system@gmail.com"!==n)return s(!0),void l(!1);window.localStorage.setItem(N,t),l(!0)}}),window.google.accounts.id.renderButton(document.getElementById("buttonDiv"),{theme:"outline",size:"large"}),window.google.accounts.id.prompt()},n=()=>{const e=document.createElement("script");e.src="https://accounts.google.com/gsi/client",e.addEventListener("load",t),document.body.appendChild(e)},a=()=>{const t=window.localStorage.getItem(N);if(!t)return y(),l(!1),void n();const a=i(t);if(!a)return y(),l(!1),void n();u(a.email),p(a.family_name),E(a.given_name),g(a.name),h(a.picture),s(!1),l(!0),e.setUsername&&e.setUsername(a.name),e.setEmail&&e.setEmail(a.email)};return"complete"===document.readyState?a():window.addEventListener("load",a),()=>{window.removeEventListener("load",a)}}),[n]);return n?a.createElement(a.Fragment,null,a.createElement(C.A,{position:"fixed",sx:{backgroundColor:"#333"}},a.createElement($.A,{maxWidth:"xl"},a.createElement(j.A,{disableGutters:!0},a.createElement(z.A,{variant:"h6",noWrap:!0,component:"div",fontWeight:"bold",sx:{mr:2,display:"flex"},onClick:()=>(0,r.navigate)("/admin/")},"DARUMA ADMIN TOOLS"),a.createElement(I.A,{sx:{flexGrow:1,display:{xs:"none",md:"flex"}}},a.createElement(D.A,{sx:{color:"#fff"},onClick:()=>(0,r.navigate)("/admin/invitations/")},"紹介システム"),a.createElement(D.A,{sx:{color:"#fff",textTransform:"none"},onClick:()=>{window.open("https://analytics.google.com/analytics/web/#/p299554539/reports/intelligenthome","_blank","noreferrer")}},"Google Analytics",a.createElement("small",null,"（アクセス解析）")),a.createElement(D.A,{sx:{color:"#fff",textTransform:"none"},onClick:()=>{window.open("https://search.google.com/search-console?resource_id=sc-domain:daruma-inv.com","_blank","noreferrer")}},"Google Search Console",a.createElement("small",null,"（SEO解析）"))),a.createElement(D.A,{variant:"contained",color:"error",startIcon:a.createElement(R.A,null),onClick:()=>{var e,t,n,a;null===(e=window)||void 0===e||null===(t=e.google)||void 0===t||null===(n=t.accounts)||void 0===n||null===(a=n.id)||void 0===a||a.disableAutoSelect(),window.localStorage.removeItem(N),y(),l(!1)},sx:{mx:2}},"ログアウト"),a.createElement(I.A,{display:"flex",flexDirection:"row",alignItems:"center"},a.createElement(I.A,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},a.createElement(z.A,{fontSize:14,fontWeight:"bold"},f),a.createElement(z.A,{fontSize:10},"(",m,")")),a.createElement(P,{src:v,sx:{ml:1}}))))),a.createElement($.A,{maxWidth:"xl",sx:{mt:10}},t)):a.createElement(a.Fragment,null,a.createElement($.A,{sx:{width:"100vw",height:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},a.createElement(I.A,{my:2},a.createElement(z.A,{variant:"h6"},"DARUMA ADMIN TOOLS")),a.createElement(I.A,null,a.createElement(I.A,{id:"buttonDiv",sx:{display:"flex",justifyContent:"center"}}),a.createElement(c.A,{severity:"error",sx:{opacity:o?1:0,pointerEvents:"none"}},"この Google アカウントのログインは許可していません。"))))}},4529:function(e,t,n){n.r(t),n.d(t,{default:function(){return H}});var a=n(6540),r=n(4945),l=n.n(r),o=n(9502),i=n(9067),c=n(6990),s=n(779),m=n(5239),u=n(4433),d=n(7458),p=n(5046),A=n(2924),E=n(4855),f=n(995),g=n(4137),v=n(3884),h=n(4774),y=n(3198),w=n(6627),S=n(6798),b=n(2471),x=n(4073),k=n(6718),P=n(2030),C=n(8031),I=n(8763),D=n(2477),$=n(7867),j=n(6831),z=n(1641),R=n(2397),N=n(177),B=n(2987),U=n(1966),L=n(6434),M=n(4348),O=n(443),W=n(4747),T=n(5673),F=n(542),_=n(7583),K=n(9399);var G=e=>{const{0:t,1:n}=(0,a.useState)(e.clientsPartner.name),{0:r,1:o}=(0,a.useState)(e.clientsPartner.partnerId),{0:s,1:u}=(0,a.useState)(e.clientsPartner.note),{0:d,1:p}=(0,a.useState)(e.clientsPartner.uuid),{0:A,1:E}=(0,a.useState)(e.clientsPartner.name),{0:g,1:v}=(0,a.useState)(e.clientsPartner.partnerId),{0:y,1:w}=(0,a.useState)(e.clientsPartner.note),{0:k,1:P}=(0,a.useState)(!0),{0:G,1:H}=(0,a.useState)(!0),{0:J,1:q}=(0,a.useState)(e.clientsPartner.createdAt),{0:Q,1:V}=(0,a.useState)(e.clientsPartner.updatedAt),{0:X,1:Y}=(0,a.useState)(e.clientsPartner.createdBy),{0:Z,1:ee}=(0,a.useState)(e.clientsPartner.updatedBy),{0:te,1:ne}=(0,a.useState)(!1),{0:ae,1:re}=(0,a.useState)(!1),{0:le,1:oe}=(0,a.useState)(""),{0:ie,1:ce}=(0,a.useState)("");(0,a.useEffect)((()=>{const t=`https://daruma-inv.com/invitations/?uuid=${e.clientsPartner.uuid}`;(async()=>{try{const e=await _.toDataURL(t);ce(e)}catch(e){console.error(e)}})(),oe(t),n(e.clientsPartner.name),o(e.clientsPartner.partnerId),u(e.clientsPartner.note),p(e.clientsPartner.uuid),E(e.clientsPartner.name),v(e.clientsPartner.partnerId),w(e.clientsPartner.note),P(!0),H(!0),q(e.clientsPartner.createdAt),V(e.clientsPartner.updatedAt),Y(e.clientsPartner.createdBy),ee(e.clientsPartner.updatedBy)}),[e.clientsPartner.uuid,e.clientsPartner.name,e.clientsPartner.partnerId,e.clientsPartner.note,e.clientsPartner.createdAt,e.clientsPartner.updatedAt,e.clientsPartner.createdBy,e.clientsPartner.updatedBy,e.username]);const se=()=>ne(!1),me=e.partners.find((e=>{let{uuid:t}=e;return t===g})),ue=`${me.lastNameKanji} ${me.firstNameKanji}`,de=()=>{const{0:e,1:t}=(0,a.useState)(!1);return a.createElement(K.CopyToClipboard,{text:le,onCopy:()=>t(!0)},a.createElement(R.A,{onClose:()=>t(!1),open:e,title:"コピーしました"},a.createElement(c.A,{fullWidth:!0,variant:"outlined",size:"small",startIcon:a.createElement(N.A,null)},"URLをコピーする")))};return a.createElement(a.Fragment,null,a.createElement(S.A,{hover:!0,selected:!k||!G},a.createElement(h.A,null,a.createElement(i.A,{display:"flex",flexDirection:"column"},a.createElement(i.A,null,a.createElement(c.A,{fullWidth:!0,variant:"outlined",size:"small",startIcon:a.createElement(T.A,null),onClick:()=>re(!0)},"QRを表示する")),a.createElement(i.A,{mt:1},a.createElement(de,null)),a.createElement(i.A,{mt:1},a.createElement(c.A,{fullWidth:!0,variant:"outlined",size:"small",startIcon:a.createElement(O.A,null),onClick:()=>{window.location.href=`mailto:?subject=【DARUMA】${A}様専用 お客様ご紹介ページ&body=${A}様%0D%0A%0D%0Aいつもお世話になっております。ダルマ株式会社の${ue}です。%0D%0A${A}様専用のお客様ご紹介ページをご用意しましたので、ご活用いただければ幸いです。%0D%0A%0D%0A【お客様ご紹介ページ】%0D%0A${le}%0D%0A%0D%0Aご紹介システムの使い方などでご不明な点がございましたらお気軽にお問い合わせください。%0D%0Aよろしくお願いいたします。%0D%0A%0D%0Aダルマ株式会社%0D%0A${ue}`}},"メールで送る")),a.createElement(i.A,{mt:1},a.createElement(c.A,{fullWidth:!0,variant:"outlined",size:"small",color:"success",startIcon:a.createElement(U.A,null),onClick:()=>{const e=`https://social-plugins.line.me/lineit/share?url=${le}`;window.open(e,"_blank","noreferrer")}},"LINEで送る")),a.createElement(i.A,{mt:1},a.createElement(c.A,{fullWidth:!0,size:"small",color:"warning",endIcon:a.createElement(L.A,null),onClick:()=>window.open(le,"_blank","noreferrer")},"お客様用ページを開く"))),a.createElement(C.A,{open:ae,onClose:()=>re(!1)},a.createElement(j.A,null,a.createElement(x.A,{variant:"h6",textAlign:"center"},A,"様専用 お客様ご紹介ページURL")),a.createElement(D.A,null,a.createElement($.A,null,a.createElement("img",{src:ie,style:{display:"block",margin:"0 auto",width:"100px",height:"100px"}}),le,a.createElement(de,null))))),a.createElement(h.A,null,a.createElement(b.A,{value:A,onChange:e=>{let{target:{value:n}}=e;const a=n!==t||g!==r||y!==s;P(!(n&&a)),H(!a),E(n)},InputProps:{endAdornment:a.createElement(m.A,{position:"end"},"様")}})),a.createElement(h.A,null,a.createElement(x.A,null,ue)),a.createElement(h.A,null,a.createElement(b.A,{value:y,multiline:!0,onChange:e=>{let{target:{value:n}}=e;const a=A!==t||g!==r||n!==s;P(!(A&&a)),H(!a),w(n)}})),a.createElement(h.A,null,a.createElement(f.A,{direction:"column",spacing:1},a.createElement(R.A,{title:"このレコードの変更を保存する"},a.createElement("span",null,a.createElement(z.A,{color:"primary","aria-label":"update",size:"large",disabled:k,onClick:async()=>{try{const t=await l()(`https://api.daruma-inv.com/api/partners/clients/${d}`,{method:"PUT",body:JSON.stringify({name:A,partnerId:g,note:y,updatedBy:e.username})});if(t.status>=400)throw new Error("Bad response /api/partners/clients");const{name:a,partnerId:r,note:i,createdAt:c,updatedAt:s,createdBy:m,updatedBy:p}=await t.json();n(a),o(r),u(i),E(a),v(r),w(i),P(!0),H(!0),q(c),V(s),Y(m),ee(p)}catch(t){alert("error"),console.log(t)}}},a.createElement(M.A,{fontSize:"inherit"})))),a.createElement(R.A,{title:"このレコードの変更を元に戻す"},a.createElement("span",null,a.createElement(z.A,{color:"warning","aria-label":"undo",size:"large",disabled:G,onClick:()=>{E(t),v(r),w(s),P(!0),H(!0)}},a.createElement(W.A,{fontSize:"inherit"})))),-1!==["koujirou0111@gmail.com","sugioka@daruma-inv.com","kyoda@daruma-inv.com"].indexOf(e.email)&&a.createElement(R.A,{title:"このレコードを削除する"},a.createElement("span",null,a.createElement(z.A,{color:"error","aria-label":"delete",size:"large",onClick:()=>ne(!0)},a.createElement(B.A,{fontSize:"inherit"})))))),a.createElement(h.A,null,a.createElement(x.A,{variant:"body2"},(0,F.A)(J)," ",a.createElement("small",null,"作成 (",X,")")),a.createElement(x.A,{variant:"body2"},(0,F.A)(Q)," ",a.createElement("small",null,"更新 (",Z,")")))),a.createElement(C.A,{open:te,onClose:se,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement(j.A,{id:"alert-dialog-title"},"このレコードの削除しますか？"),a.createElement(D.A,null,a.createElement($.A,{id:"alert-dialog-description"},"顧客名　: ",t,a.createElement("br",null),"担当者　:"," ",(()=>{const t=e.partners.filter((e=>{let{uuid:t}=e;return t===r}))[0];return`${t.lastNameKanji} ${t.firstNameKanji}`})(),a.createElement("br",null),"メモ　　: ",s,a.createElement("br",null),"作成日時: ",(0,F.A)(J)," (",X,")",a.createElement("br",null),"更新日時: ",(0,F.A)(Q)," (",Z,")")),a.createElement(I.A,null,a.createElement(c.A,{onClick:se},"キャンセル"),a.createElement(c.A,{onClick:async()=>{try{if((await l()(`https://api.daruma-inv.com/api/partners/clients/${e.clientsPartner.uuid}`,{method:"DELETE"})).status>=400)throw new Error("Bad response /api/partners/clients");e.reload(),ne(!1)}catch(t){console.log(t)}},autoFocus:!0},"削除する"))))};var H=()=>{const{0:e,1:t}=(0,a.useState)(!1),{0:n,1:r}=(0,a.useState)("info"),{0:C,1:I}=(0,a.useState)(""),{0:D,1:$}=(0,a.useState)([]),{0:j,1:z}=(0,a.useState)([]),{0:R,1:N}=(0,a.useState)(""),{0:B,1:U}=(0,a.useState)(""),{0:L,1:M}=(0,a.useState)(""),{0:O,1:W}=(0,a.useState)(!0),{0:T,1:F}=(0,a.useState)(0),{0:_,1:K}=(0,a.useState)(""),{0:H,1:J}=(0,a.useState)("");return(0,a.useEffect)((()=>{(async()=>{try{const e=await l()("https://api.daruma-inv.com/api/partners"),t=await l()("https://api.daruma-inv.com/api/partners/clients");if(e.status>=400)throw new Error("Bad response /api/partners");if(t.status>=400)throw new Error("Bad response /api/partners/clients");const n=await e.json(),a=await t.json();$(n),z(a)}catch(e){console.log(e)}})()}),[T]),a.createElement(P.A,{setUsername:K,setEmail:J},a.createElement(x.A,{variant:"h6"},"紹介システム 権限付与",a.createElement("small",null,"（DARUMA → オーナー様）")),a.createElement(i.A,{display:"flex",my:2,pl:2,py:4,sx:{border:"2px solid #ccc",borderRadius:2}},a.createElement(b.A,{label:"顧客名",variant:"outlined",value:R,InputProps:{endAdornment:a.createElement(m.A,{position:"end"},"様")},onChange:e=>{const t=e.target.value;N(t),W(!B||!t)}}),a.createElement(s.A,{sx:{minWidth:120}},a.createElement(u.A,null,"担当者"),a.createElement(A.A,{label:"担当者",value:B,onChange:e=>{const t=e.target.value;U(t),W(!t||!R)}},D.map(((e,t)=>{let{uuid:n,lastNameKanji:r,firstNameKanji:l,lastName:o,firstName:i}=e;const c=r&&l?`${r} ${l}`:`${o} ${i}`;return a.createElement(p.A,{key:t,value:n},c)})))),a.createElement(b.A,{label:"メモ",variant:"outlined",multiline:!0,value:L,onChange:e=>{let{target:{value:t}}=e;return M(t)},sx:{minWidth:320}}),a.createElement(c.A,{variant:"contained",color:"primary",startIcon:a.createElement(k.A,null),disabled:O,onClick:async()=>{try{if((await l()("https://api.daruma-inv.com/api/partners/clients",{method:"POST",body:JSON.stringify({name:R,partnerId:B,note:L,createdBy:_})})).status>=400)throw new Error("Bad response /api/partners/clients");t(!0),r("success"),I(`${R} 様の情報を追加しました`),N(""),U(""),M(""),W(!0),F(T+1)}catch(e){alert("error"),console.log(e)}}},"新規作成")),a.createElement(y.A,null,a.createElement(g.A,null,a.createElement(w.A,null,a.createElement(S.A,null,a.createElement(h.A,null,"URL"),a.createElement(h.A,null,"顧客名"),a.createElement(h.A,null,"担当者"),a.createElement(h.A,null,"メモ"),a.createElement(h.A,null,"操作"),a.createElement(h.A,null,"タイムスタンプ"))),a.createElement(v.A,null,j[0]?j.map(((e,t)=>a.createElement(G,{key:t,clientsPartner:e,partners:D,username:_,email:H,reload:()=>F(T+1)}))):a.createElement(S.A,null,a.createElement(h.A,{colSpan:6},a.createElement(x.A,{align:"center"},"Loading..."),a.createElement(d.A,null)))))),a.createElement(f.A,{spacing:2,sx:{width:"100%"}},a.createElement(E.A,{open:e,autoHideDuration:5e3,onClose:(e,n)=>{"clickaway"!==n&&t(!1)}},a.createElement(o.A,{severity:n},C))))}}}]);
//# sourceMappingURL=component---src-pages-admin-invitations-index-js-a4375e321a016f44b63f.js.map